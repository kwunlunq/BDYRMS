<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script type='text/javascript' src='/BDYRMS/js/jquery.js'></script>
<script type='text/javascript' src='/BDYRMS/dwr/engine.js'></script>
<script type='text/javascript' src='/BDYRMS/dwr/interface/Chat.js'></script>
<script type='text/javascript' src="/BDYRMS/dwr/util.js"></script>
<script type="text/javascript">
function sendMessage() {
    var text = dwr.util.getValue("text");
    dwr.util.setValue("text", "");
    Chat.addMessage(text, gotMessages);
}
 
function gotMessages(messages) {
    var chatlog = "";
    for (var data in messages) {
        chatlog = "<div>" + messages[data].text +
            "</div>" + chatlog;
    }
    //dwr.util.setValue("chatlog", chatlog);
    $('#chatlog').html(chatlog);
    checkRoll();
    setTimeout("queryMessage()", 2000);
}

function queryMessage() {
  	Chat.getMessages(gotMessages);
}
function checkRoll(){ //用來固定 卷軸的位置 在 DIV 的最下方
	$('#chatlog').scrollTop($(document).height());	
}
</script>
</head>
<body>
<p>
  Your Message:
  <input id="text"/>
  <input type="button" value="Send"
      onclick="sendMessage()"/>
</p>
 
<p>Messages:</p>
<div id="chatlog" style="overflow:auto;width:300px;height:100px;border:1px dotted blue;"></div>
<div style="position:absolute;top:30%">
程式概述:
<ul>
	<li>簡單的聊天室 寫一個讀取資料的 JS function 利用setTimeout 每隔2秒 讀取後端訊息</li>
	<li>以上都是簡單的幾個小程式 熟悉一下 DWR的運作模式</li>
	<li>我們需要的是 DWR 中 reverse ajax 的技術</li>
	<li>可以自動將後端的訊息PUSH到前端，這樣就不用使用setTimeout()去获取信息了</li>
	<li>還在找reverse ajax 的相關技術文章 又為了先釋放出這些範例 所以 範例就先做到這</li>
</ul>
檔案清單:
<ul>
	<li>src/chat.java</li>
	<li>src/Message.java</li>
	<li>WEB-INF/dwr.xml</li>
	<li>dwrDemo/chat.html</li>
</ul>
JS程式碼:
<pre>
function sendMessage() {
    var text = dwr.util.getValue("text");
    dwr.util.setValue("text", "");
    Chat.addMessage(text, gotMessages);
}
 
function gotMessages(messages) {
    var chatlog = "";
    for (var data in messages) {
        chatlog = "<div>" + messages[data].text +
            "</div>" + chatlog;
    }
    //dwr.util.setValue("chatlog", chatlog);
    $('#chatlog').html(chatlog);
    checkRoll();
    setTimeout("queryMessage()", 2000);
}

function queryMessage() {
  	Chat.getMessages(gotMessages);
}
function checkRoll(){ //用來固定 卷軸的位置 在 DIV 的最下方
	$('#chatlog').scrollTop($(document).height());	
}
</pre>
</div>
</body>
</html>